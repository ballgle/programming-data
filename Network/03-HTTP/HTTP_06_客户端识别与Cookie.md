# 客户端识别与 cookie 机制

Web 服务器可能会同时与数千个不同的客户端进行对话。这些服务器通常要记录下它们在与谁交谈，而不会认为所有的请求都来自匿名的客户端。

HTTP 最初是一个`匿名、无状态的请求/响应协议`。服务器处理来自客户端的请求，然后向客户端回送一条响应。Web 服务器几乎没有什么信息可以用来判定是哪个用户发送的请求，也无法记录来访用户的请求序列。现代的 Web 站点希望能够提供个性化的接触。它们希望对连接另一端的用户有更多的了解，并且能在用户浏览页面时对其进行跟踪。比如一个流行的在线商店网站可以通过以下几种方式实现站点的个性化：

- **个性化的问候**：专门为用户生成的欢迎词和页面内容，使购物体验更加个性化。
- **有的放矢的推荐**：通过了解客户的兴趣，商店可以推荐一些它们认为客户会感兴趣的商品。商店还可以在临近客户生日或其他一些重要日子的时候提供生日特定的商品。
- **管理信息的存档**：在线购物的用户不喜欢一次又一次地填写繁琐的地址和信用卡信息。有些站点会将这些管理细节存储在一个数据库中。只要他们识别出用户，就可以使用存档的管理信息，使得购物体验更加便捷。
- **记录会话**：HTTP 事务是无状态的。每条请求/响应都是独立进行的。很多 Web 站点希望能在用户与站点交互的过程中（比如，使用在线购物车的时候）构建增量状态。要实现这一功能，Web 站点就需要有一种方式来区分来自不同用户的 HTTP 事务。

HTTP 并不是天生就具有丰富的识别特性的。早期的 Web 站点设计者们都有自己的用户识别技术。每种技术都有其优势和劣势。常用的用户识别机制如下：

- 承载用户身份信息的HTTP首部。
- 客户端IP地址跟踪，通过用户的IP地址对其进行识别。
- 用户登录，用认证方式来识别用户。
- 胖URL，一种在URL中嵌入识别信息的技术。

## Cookie

cookie 是当前识别用户，实现持久会话的最好方式。cookie 最初是由网景公司开发的，但现在所有主要的浏览器都支持它。cookie 非常重要，而且它们定义了一些新的HTTP首部。cookie 的存在也影响了缓存，大多数缓存和浏览器都不允许对任何 cookie 的内容进行缓存。

- **cookie的类型**：可以笼统地将cookie分为两类：会话cookie和持久cookie。会话cookie是一种临时cookie，它记录了用户访问站点时的设置和偏好。用户退出浏览器时，会话cookie就被删除了。持久cookie的生存时间更长一些；它们存储在硬盘上，浏览器退出，计算机重启时它们仍然存在。通常会用持久cookie维护某个用户会周期性访问的站点的配置文件或登录名。
- **cookie是如何工作的**：用户首次访问Web站点时，Web服务器对用户一无所知。Web 服务器希望这个用户会再次回来，所以想给这个用户“拍上”一个独有的 cookie，这样以后它就可以识别出这个用户了。cookie 中包含了一个由 `名字=值（name=value）`这样的信息构成的任意列表，并通过 Set-Cookie 或 Set-Cookie2 HTTP响应（扩展）首部将其贴到用户身上去。
- **cookies版本**：
  - 最初的cookie规范是由网景公司定义的。这些“版本0”的cookie定义了Set-Cookie响应首部、cookie请求首部以及用于控制cookie的字段。
  - FC  2965（以前的RFC  2109）定义了一个cookie的扩展版本。这个版本1标准引入了Set-Cookie2首部和Cookie2首部，但它也能与版本0系统进行互操作。

关于 Cookie，具体参考下面资料：

- 《HTTP权威指南》 第十一章
- [实用 HTTP-再好好聊聊 HTTP 里的 Cookie](https://www.cnblogs.com/plokmju/p/http_cookie.html)
- [聊一聊 cookie](https://segmentfault.com/a/1190000004556040)
